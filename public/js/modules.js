angular.module("elementBoxApp.about",[]).config(["$stateProvider",function(e){e.state("main.about",{url:"/about",templateUrl:"about/about.html",controller:["$rootScope",function(e){e.$emit("title","About")}]})}]),angular.module("elementBoxApp.account",["elementBoxApp.account.myitems","elementBoxApp.account.mywishlist","elementBoxApp.account.profile"]).config(["$stateProvider",function(e){e.state("main.account",{url:"/account",templateUrl:"account/account.html",controller:"AccountCtrl"})}]),angular.module("elementBoxApp.account").controller("AccountCtrl",["$scope","$rootScope","$state",function(e,t,n){e.activeState=n.current.name,t.$emit("title","My Account"),"main.account"===n.current.name&&n.go("main.account.myitems"),e.setState=function(t){e.activeState=t}}]),angular.module("elementBoxApp.element",["elementBoxApp.common"]).config(["$stateProvider",function(e){e.state("main.element",{url:"/element/:id",templateUrl:"element/element.html",controller:"ElementCtrl"})}]),angular.module("elementBoxApp.element").controller("ElementCtrl",["$scope","$stateParams","Element",function(e,t,n){var o={element:n.get({id:t.id})};angular.extend(e,o)}]),angular.module("elementBoxApp.error404",[]).config(["$stateProvider",function(e){e.state("main.404",{url:"/404",templateUrl:"error404/error404.html",controller:"Error404Ctrl"})}]),angular.module("elementBoxApp.error404").controller("Error404Ctrl",["$scope","$rootScope",function(e,t){e.greetings="Good Bye!",t.$emit("title",e.defaultTitle)}]),angular.module("elementBoxApp.home",[]).config(["$stateProvider",function(e){e.state("main.home",{url:"/home",templateUrl:"home/home.html",controller:"HomeCtrl"})}]),angular.module("elementBoxApp.home").controller("HomeCtrl",["$scope","$rootScope","Categories",function(e,t,n){e.categs=[],t.$emit("title",e.defaultTitle);var o=function(){var t=n.getCategoriesTree();t.query({flat:!0}).$promise.then(function(t){e.categs=t})};o()}]),angular.module("elementBoxApp.main",[]).config(["$stateProvider",function(e){e.state("main",{url:"",templateUrl:"main/main.html",controller:"MainCtrl"})}]),angular.module("elementBoxApp.main").controller("MainCtrl",["$state","$scope","$rootScope",function(e,t,n){"main"===e.current.name&&e.go("main.home"),t.appTitle="",t.defaultTitle="SandBox App",t.menuOpened=!1,t.toggleMenu=function(){t.menuOpened=!t.menuOpened},n.$on("title",function(e,n){t.appTitle=n})}]),angular.module("elementBoxApp.myadmin",["elementBoxApp.myadmin.categorymanag","elementBoxApp.myadmin.userlist","elementBoxApp.myadmin.myitems","elementBoxApp.myadmin.allitems","ui.tree"]).config(["$stateProvider",function(e){e.state("main.myadmin",{url:"/myadmin",templateUrl:"myadmin/myadmin.html",controller:"MyAdminCtrl"}),e.state("main.myadmin.mywishlist",{url:"/mywishlist",templateUrl:"account/mywishlist/mywishlist.html",controller:"MyWishListCtrl"}),e.state("main.myadmin.profile",{url:"/profile",templateUrl:"account/profile/profile.html",controller:"MyAccountProfileCtrl"})}]),angular.module("elementBoxApp.myadmin").controller("MyAdminCtrl",["$scope","$rootScope","$state","$stateParams",function(e,t,n){e.activeState=n.current.name,t.$emit("title","My Admin"),"main.myadmin"===n.current.name&&n.go("main.myadmin.categorymanag"),e.setState=function(t){e.activeState=t}}]),angular.module("elementBoxApp.newelement",[]).config(["$stateProvider",function(e){e.state("main.newelement",{url:"/newelement",templateUrl:"newelement/newelement.html",controller:"NewElementCtrl"})}]),angular.module("elementBoxApp.newelement").controller("NewElementCtrl",["$scope","$rootScope","$location","Element","Statistics",function(e,t,n,o,r){var a={newElement:{title:"",content:"",like:"",dontLike:"",date:""},successfulyCreated:!1,unsuccessfulyCreated:!1,cancelBtnTxt:"Cancel and Go Back",addElement:function(){t.elements||(t.elements=[]);var n=o.save(e.newElement);n.$promise.then(function(){t.elements.push(n),e.successfulyCreated=!0,e.unsuccessfulyCreated=!1,e.newElement.title="",e.newElement.content="",e.newElement.like=0,e.newElement.dontLike=0,e.newElement.date="",r.elementCreated()},function(){e.unsuccessfulyCreated=!0,e.successfulyCreated=!1})},today:new Date};angular.extend(e,a)}]),angular.module("elementBoxApp.products",["elementBoxApp.products.productInfo","elementBoxApp.products.productNew","elementBoxApp.products.productList","elementBoxApp.products.productEdit"]).run(["$rootScope","$state",function(e,t){e.$on("$stateChangeStart",function(e,n){"main.products"===n.name&&(e.preventDefault(),t.go("main.products.list",{categ:"all",page:"1"}))})}]).config(["$stateProvider",function(e){e.state("main.products",{url:"/products",template:"<ui-view />"})}]),angular.module("elementBoxApp.products").factory("CommentsService",["Urls","$resource",function(e,t){var n=t(e.products.products+"/:prodId/comments/:commentId",{prodId:"@prodId",commentId:"@commentId"},{query:{method:"GET",isArray:!1,transformResponse:function(e,t,o){var r=JSON.parse(e);return o>=200&&300>o?r.results.forEach(function(e,t){r.results[t]=new n(e)}):r.results=[],r}}});return n}]),angular.module("elementBoxApp.products").service("ProdErrorsService",["Urls","$resource",function(){var e=function(e,t,n){e.category=!n,e.title=!t.title||!(t.title.length>=5&&t.title.length<=55),e.price=""===t.price||t.price<0,e.description=!t.description,e.images=!t.images};return{checkProdErrors:e}}]),angular.module("elementBoxApp.signin",[]).config(["$stateProvider",function(e){e.state("main.signin",{url:"/signin",templateUrl:"signin/signin.html",controller:"SigninCtrl"})}]),angular.module("elementBoxApp.signin").controller("SigninCtrl",["$scope","$rootScope","$timeout","AUTH_EVENTS","AuthService","$state",function(e,t,n,o,r,a){return r.isAuthenticated()?void a.go("main.home"):(t.$emit("title","Sign In"),e.displayError=!1,e.invalidCredentials=!1,e.showCredAlert=!1,e.credentials={email:"",password:""},void(e.signin=function(a){return a?void r.signin(e.credentials).then(function(n){t.$broadcast(o.singinSuccess,{user:n.data.user,navigate:!0}),e.displayError=!1,e.invalidCredentials=!1},function(){e.invalidCredentials=!1,e.showCredAlert=!1,e.displayError=!0,n(function(){e.invalidCredentials=!0,e.showCredAlert=!0},1)}):void(e.displayError=!0)}))}]),angular.module("elementBoxApp.signout",[]).config(["$stateProvider",function(e){e.state("main.signout",{url:"/signout",templateUrl:"signout/signout.html",controller:["$rootScope","$state","Session",function(e,t,n){return e.$emit("title","Sign Out"),n.getSession()&&n.getSession().user?void t.go("main.home"):void e.$emit("app-msg",{txt:"You are logged out!"})}]})}]),angular.module("elementBoxApp.signup",[]).config(["$stateProvider",function(e){e.state("main.signup",{url:"/signup",templateUrl:"signup/signup.html",controller:"SignupCtrl"})}]),angular.module("elementBoxApp.signup").controller("SignupCtrl",["$scope","$rootScope","$state","AUTH_EVENTS","AuthService",function(e,t,n,o,r){return r.isAuthenticated()?void n.go("main.home"):(t.$emit("title","Sign Up"),e.displayError=!1,e.errors={},e.credentials={firstName:"",lastName:"",email:"",password:"",displayName:"",username:""},void(e.signup=function(n){return n?void r.signup(e.credentials).then(function(n){t.$broadcast(o.singinSuccess,{user:n.data.user,navigate:!0}),e.displayError=!1},function(t){console.log(t.data.errors),angular.extend(e.errors,t.data.errors||{})}):void(e.displayError=!0)}))}]),angular.module("elementBoxApp.terms",[]).config(["$stateProvider",function(e){e.state("main.terms",{url:"/terms",templateUrl:"terms/terms.html",controller:["$rootScope",function(e){e.$emit("title","Terms of Service")}]})}]),angular.module("elementBoxApp.userdetails",[]).config(["$stateProvider",function(e){e.state("main.userdetails",{url:"/userdetails/:id",templateUrl:"userdetails/userdetails.html",controller:"UserDetailsCtrl"})}]).filter("hidePhone",function(){return function(e){return e?new Array(e.length-2).join("â–’")+e.substr(e.length-2):""}}),angular.module("elementBoxApp.userdetails").controller("UserDetailsCtrl",["$scope","$rootScope","$stateParams","UserService","ProductsService",function(e,t,n,o,r){var a=1,i=6;if(t.$emit("title","User Details"),n.id){e.ownProducts=[],e.totalProducts=0,e.userReported=!1,e.user=o.get({id:n.id});var c=function(t,o){r.get({userId:n.id,page:t,pageSize:o},function(t){Array.prototype.push.apply(e.ownProducts,t.results),e.totalProducts=t.total})};e.showMoreProducts=function(){c(++a,i)},e.reportUser=function(){e.userReported=!0},e.undoReportUser=function(){e.userReported=!1},e.getProdThumbnail=function(e){var t=e.images.length?e.images[0].url:"imgs/no-picture-medium.png";return t.replace("image/upload","image/upload/c_fill,h_140,w_210")},c(a,i)}}]),angular.module("elementBoxApp.account.myemails",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.account.myemails",{url:"/myemails",templateUrl:"account/myemails/myemails.html",controller:"MyAccountEmailsCtrl"})}]),angular.module("elementBoxApp.account.myemails").controller("MyAccountEmailsCtrl",["$scope","$rootScope","$stateParams","$filter","$state","ProductsService","ModalAlert","AUTH_EVENTS",function(e,t,n,o,r,a,i,c){e.products=[],e.page=1,e.pageSize=3,e.totalPages=0,e.totalProducts=0,e.fetchPage=function(){},!e.currentUser||angular.equals({},e.currentUser)?t.$on(c.singinSuccess,function(){e.fetchPage()}):e.fetchPage()}]),angular.module("elementBoxApp.account.myitems",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.account.myitems",{url:"/myitems",templateUrl:"account/myitems/myitems.html",controller:"MyAccountItemsCtrl"})}]),angular.module("elementBoxApp.account.myitems").controller("MyAccountItemsCtrl",["$scope","$rootScope","$stateParams","$filter","$state","ProductsService","ModalAlert","AUTH_EVENTS",function(e,t,n,o,r,a,i,c){e.products=[],e.page=1,e.pageSize=3,e.totalPages=0,e.totalProducts=0,e.$parent.activeState=r.current.name,e.fetchPage=function(){a.query({userId:e.currentUser.id,page:e.page,pageSize:e.pageSize}).$promise.then(function(t){e.products=t.results,e.page=t.page,e.totalPages=t.totalPages,e.totalProducts=t.total,e.pageSize=t.pageSize})},e.removeProduct=function(t){i.alert({title:"Delete product",msg:'Do you want to delete the product? \n	"'+t.title+'"',hasCancel:!0}).then(function(){t.$remove().$promise.then(function(){e.fetchPage()})})},e.$watch("page",function(){e.fetchPage()}),!e.currentUser||angular.equals({},e.currentUser)?t.$on(c.singinSuccess,function(){e.fetchPage()}):e.fetchPage()}]),angular.module("elementBoxApp.account.mywishlist",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.account.mywishlist",{url:"/mywishlist",templateUrl:"account/mywishlist/mywishlist.html",controller:"MyWishListCtrl"})}]),angular.module("elementBoxApp.account.mywishlist").controller("MyWishListCtrl",["$scope","$rootScope","$state","UserService","ModalAlert","AUTH_EVENTS",function(e,t,n,o,r,a){e.wishList=[],e.page=1,e.pageSize=3,e.totalPages=0,e.totalItems=0,e.$parent.activeState=n.current.name,e.fetchPage=function(){o.queryWishList({page:e.page,pageSize:e.pageSize}).$promise.then(function(t){e.wishList=t.results,e.page=t.page,e.totalPages=t.totalPages,e.totalItems=t.total,e.pageSize=t.pageSize})},e.$watch("page",function(){e.fetchPage()}),e.removeFromWishList=function(t){r.alert({title:"Delete Wish List item",msg:"Do you want to delete it from Wish List?",hasCancel:!0}).then(function(){o.removeFromWishList({itemId:t._id}).$promise.then(function(){e.fetchPage()})})},!e.currentUser||angular.equals({},e.currentUser)?t.$on(a.singinSuccess,function(){e.fetchPage()}):e.fetchPage()}]),angular.module("elementBoxApp.account.profile",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.account.profile",{url:"/profile",templateUrl:"account/profile/profile.html",controller:"MyAccountProfileCtrl"})}]),angular.module("elementBoxApp.account.profile").controller("MyAccountProfileCtrl",["$scope","$rootScope","$timeout","UserService","Session",function(e,t,n,o,r){e.user={},e.edittingNames=!1,e.changed=!1;var a=function(){o.me().$promise.then(function(t){t&&(e.user=t,e.changed=!1)})},i=r.getSession();i?e.user=r.getSession().user:a(),e.toggleEditNames=function(){e.edittingNames=!e.edittingNames},e.saveUser=function(){var t={_id:e.user._id,firstName:e.user.firstName,lastName:e.user.lastName,displayName:e.user.displayName,description:e.user.description};o.updateMe(t).$promise.then(function(t){e.edittingNames=!1,t&&(e.user=t,e.currentUser=t,r.setUser(t),e.changed=!1)})};var c=function(t,o){t&&o&&t!==o&&n(function(){e.changed=!0})};e.$watch("user.lastName",c),e.$watch("user.firstName",c),e.$watch("user.description",c)}]),angular.module("elementBoxApp.home").controller("FilterCtrl",["$scope","$rootScope",function(e,t){t.searchTxt="",e.searchTxt="",e.filter=function(){t.searchTxt=e.searchTxt},e.clearFilter=function(){t.searchTxt=e.searchTxt=""}}]),angular.module("elementBoxApp.main").controller("FooterCtrl",["$scope","$state","$stateParams","$location","Statistics",function(){}]),angular.module("elementBoxApp.main").controller("HeaderCtrl",["$scope","$rootScope","$state","$stateParams","AuthService","AUTH_EVENTS",function(e,t,n,o,r,a){e.currentState=n.current.name,t.$on("$stateChangeSuccess",function(t,n){e.currentState=n.name}),e.signout=function(){r.signout(e.credentials).then(function(e){t.$broadcast(a.signoutSuccess,e.data.user),n.go("main.signout")})}}]),angular.module("elementBoxApp.main").controller("MenuCtrl",["$scope","$state","USER_ROLES",function(e,t,n){e.Roles=n,e.menuItems=[{text:"Home",goTo:"main.home",icon:"glyphicon-home","class":"menu-home",displayIf:function(){return e.showLink("main.home")}},{text:"Products",goTo:"main.products",icon:"glyphicon-th-list","class":"menu-products",displayIf:function(){return e.showLink("main.products")}},{text:"Publish",goTo:"main.products.new",icon:"glyphicon-plus","class":"menu-new",displayIf:function(){return e.showLink("main.newelement")}},{text:"My Admin",goTo:"main.myadmin",icon:"glyphicon-cog","class":"menu-myadmin",displayIf:function(){return e.showLink("main.myadmin",n.admin)}},{text:"Account",goTo:"main.account",icon:"glyphicon-cog","class":"menu-account",displayIf:function(){return e.showLink("main.account",n.user)&&!e.showLink("main.account",n.admin)}}],e.showLink=function(t,n){return!n||e.currentUser&&!angular.equals({},e.currentUser)?n&&e.currentUser.roles.indexOf(n)<0?!1:!0:!1},e.isActive=function(e){var n=new RegExp("^"+e);return n.test(t.current.name)},e.goto=function(n){t.current.name!==n.goTo&&t.go(n.goTo),e.toggleMenu()}}]),angular.module("elementBoxApp.main").directive("messageSystem",[function(){return{restrict:"EA",scope:{},templateUrl:"main/message-system/message-system.html",controller:["$scope","$rootScope","$timeout",function(e,t,n){e.msg={},e.displayMsg=!1;var o=function(){t.$on("app-msg",function(t,o){n(function(){e.msg=o,e.displayMsg=!0})})};e.close=function(){n(function(){e.displayMsg=!1}),n(function(){e.msg={}},2e3)},o()}]}}]),angular.module("elementBoxApp.myadmin.allitems",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.myadmin.allitems",{url:"/allitems",templateUrl:"myadmin/allitems/allitems.html",controller:"AllItemsCtrl"})}]),angular.module("elementBoxApp.myadmin.allitems").controller("AllItemsCtrl",["$scope","ProductsService",function(e,t){e.products=[],e.page=1,e.pageSize=3,e.totalPages=0,e.totalProducts=0,e.fetchPage=function(){t.query({page:e.page,pageSize:e.pageSize}).$promise.then(function(t){e.products=t.results,e.page=t.page,e.totalPages=t.totalPages,e.totalProducts=t.total,e.pageSize=t.pageSize})},e.$watch("page",function(){e.fetchPage()}),e.fetchPage()}]),angular.module("elementBoxApp.myadmin.categorymanag",[]).config(["$stateProvider",function(e){e.state("main.myadmin.categorymanag",{url:"/categorymanag",templateUrl:"myadmin/categorymanag/categorymanag.html",controller:"CategoryManagCtrl"})}]),angular.module("elementBoxApp.myadmin.categorymanag").controller("CategoryManagCtrl",["$scope","$rootScope","$location","$modal","Categories",function(e,t,n,o,r){e.rootCategory={};var a=r.getCategoriesTree();a.query({flat:!1}).$promise.then(function(t){e.rootCategory=t},function(){e.rootCategory=[]}),e.remove=function(e){e.remove()},e.toggle=function(e){e.toggle()},e.newSubItem=function(e){var t=e.$modelValue;t.children.push({_id:t._id+(t.children.length+1),name:t.name+"-"+(t.children.length+1),thumb:"",children:[]})};var i=function(){return angular.element(document.getElementById("tree-root")).scope().$$childHead};e.collapse=function(){var e=i();e.collapseAll()},e.expand=function(){var e=i();e.expandAll()},e.save=function(){a.save({tree:JSON.stringify(e.rootCategory)},function(){console.log(arguments)})},e.edit=function(e){var t=o.open({templateUrl:"myadmin/categorymanag/partials/category-edit.html",controller:function(n){n.categ=angular.copy(e),n.applyCategChanges=function(o){o&&(angular.copy(n.categ,e),t.close())},n.cancelEdditing=function(){t.close()}},size:"lg",backdrop:"static"})},e.createRootCategory=function(){e.rootCategory.push({_id:"products",name:"Products",children:[]})}}]),angular.module("elementBoxApp.myadmin.myitems",["elementBoxApp.products"]).config(["$stateProvider",function(e){e.state("main.myadmin.myitems",{url:"/myitems",templateUrl:"myadmin/myitems/myitems.html",controller:"MyItemsCtrl"})}]),angular.module("elementBoxApp.myadmin.myitems").controller("MyItemsCtrl",["$scope","$timeout","ProductsService",function(e,t,n){e.products=[],e.page=1,e.pageSize=3,e.totalPages=0,e.totalProducts=0,e.fetchPage=function(){return e.currentUser&&e.currentUser.id?void n.query({userId:e.currentUser.id,page:e.page,pageSize:e.pageSize}).$promise.then(function(t){e.products=t.results,e.page=t.page,e.totalPages=t.totalPages,e.totalProducts=t.total,e.pageSize=t.pageSize}):void t(e.fetchPage,500)},e.$watch("page",function(){e.fetchPage()}),e.fetchPage()}]),angular.module("elementBoxApp.myadmin.userlist",[]).config(["$stateProvider",function(e){e.state("main.myadmin.userlist",{url:"/userlist",templateUrl:"myadmin/userlist/userlist.html",controller:"UserlistCtrl"})}]),angular.module("elementBoxApp.myadmin.userlist").controller("UserlistCtrl",["$scope","UserService","$location",function(e,t){e.page=1,e.pageSize=3,e.totalPages=0,e.totalProducts=0,e.users=[],e.searchField="",e.fetchPage=function(){t.query({page:e.page,pageSize:e.pageSize,filter:e.searchField||void 0}).$promise.then(function(t){e.users=t.results,e.page=t.page,e.pageSize=t.pageSize,e.totalPages=t.totalPages,e.totalUsers=t.total})},e.fetchPage(),e.deactivateUser=function(e){e.$deactivate(function(){e.active=!1})},e.activateUser=function(e){e.active=!0,e.$update(function(){e.active=!0},function(){e.active=!1})}}]),angular.module("elementBoxApp.products.productEdit",[]).config(["$stateProvider",function(e){e.state("main.products.edit",{url:"/edit/{productId}",templateUrl:"products/product-edit/product-edit.html",controller:"ProductEditCtrl"})}]),angular.module("elementBoxApp.products.productEdit").controller("ProductEditCtrl",["$scope","$rootScope","$stateParams","$q","$timeout","ngProgressService","ProductsService","Categories","ProdErrorsService",function(e,t,n,o,r,a,i,c,l){e.slides=[],e.slidesIndex=0,e.categories=[],e.productSaved=!1,e.isCategSelected=!1,e.selectedCateg=null,e.error={},e.categApi={};var s=o.defer(),u=o.defer();t.$emit("title","Edit Product"),e.product=i.get({id:n.productId},function(t){t.images=t.images?t.images:[],t.images.forEach(function(t,n){e.slides.push({url:t.url,index:n+1})}),s.resolve()});var m=c.getCategoriesTree();m.query({flat:!1}).$promise.then(function(t){e.categories=t,r(function(){u.resolve()},500)}),o.all([s.promise,u.promise]).then(function(){e.categApi.setCategory(e.product.categories[0])}),e.hasCateg=function(t){for(var n in e.product.categories)if(e.product.categories[n]===t._id)return!0;return!1},e.save=function(){return l.checkProdErrors(e.error,e.product,e.selectedCateg),e.error.category||e.error.title||e.error.price||e.error.description||e.error.images?void angular.element("body").animate({scrollTop:150},400):(a.start(),e.product.categories[0]=e.selectedCateg._id,void e.product.$update(function(){e.productSaved=e.product,a.complete(),angular.element("body").animate({scrollTop:0},400)}))},e.onCategSelected=function(t){e.isCategSelected=!0,e.selectedCateg=t[t.length-1],e.error.category=!1},e.onCategUnselected=function(){e.isCategSelected=!1,e.selectedCateg=null},e.getProdThumbnail=function(e){var t=e.images.length?e.images[0].url:"imgs/no-picture-medium.png";return t.replace("image/upload","image/upload/c_fill,h_140,w_210")}}]),angular.module("elementBoxApp.products.productInfo",["slick"]).config(["$stateProvider",function(e){e.state("main.products.info",{url:"/info/{productId}",templateUrl:"products/product-info/product-info.html",controller:"ProductInfoCtrl"})}]),angular.module("elementBoxApp.products.productInfo").controller("ProductInfoCtrl",["$scope","$rootScope","$stateParams","$timeout","ProductsService","UserService","CommentsService","EVENT_NAMES",function(e,t,n,o,r,a,i,c){e.slides=[],e.slidesIndex=0,e.userHasRated=!1,e.rateVal=null,e.newComment="";var l=!1;t.$emit("title","Product Info"),e.comments=[],e.commentsData={page:1,pageSize:3,totalPages:0,totalComments:0},e.product=r.get({id:n.productId},function(t){t.images=t.images?t.images:[],t.images.forEach(function(t,n){e.slides.push({url:t.url,index:n+1})})}),e.fetchPage=function(){i.query({prodId:n.productId,page:e.commentsData.page,pageSize:e.commentsData.pageSize}).$promise.then(function(t){e.comments=t.results,e.commentsData.page=t.page,e.commentsData.totalPages=t.totalPages,e.commentsData.totalComments=t.total,e.commentsData.pageSize=t.pageSize})},e.addComment=function(o){if(o&&o.trim()){var r={prodId:n.productId,text:o};i.save(r,function(){e.fetchPage(),t.$emit(c.addComment,r)})}},e.$watch("commentsData.page",function(){e.fetchPage()}),e.rate=function(t){e.rateVal||l||(l=!0,r.rate({_id:e.product._id,rating:t},function(){e.userHasRated=!0,e.rateVal=t,l=!1},function(){l=!1}))},e.addToWishList=function(){a.addToWishList({prodId:e.product._id},function(){t.$emit(c.addWishList,e.product)})},e.removeFromWishList=function(){a.removeFromWishList({itemId:e.product._id},function(){t.$emit(c.removeWishList,e.product)})},e.hasWishListedProduct=function(){return e.currentUser&&e.product?(e.currentUser.wishList||(e.currentUser.wishList=[]),e.currentUser.wishList.indexOf(e.product._id)>=0):!1}}]),angular.module("elementBoxApp.products.productNew",[]).config(["$stateProvider",function(e){e.state("main.products.new",{url:"/new",templateUrl:"products/product-new/product-new.html",controller:"ProductNewCtrl"})}]),angular.module("elementBoxApp.products.productNew").controller("ProductNewCtrl",["$scope","$rootScope","$stateParams","ngProgressService","ProductsService","Categories","ProdErrorsService",function(e,t,n,o,r,a,i){e.productCreated=!1,e.areImgsCollapsed=!1,e.isCategSelected=!1,e.selectedCateg=null,e.error={},t.$emit("title","Create a Product"),e.product={title:"",description:"",images:[],categories:[],price:0};var c=a.getCategoriesTree();c.query({flat:!1}).$promise.then(function(t){e.categories=t}),e.save=function(){if(i.checkProdErrors(e.error,e.product,e.selectedCateg),e.error.category||e.error.title||e.error.price||e.error.description||e.error.images)return void angular.element("body").animate({scrollTop:150},400);o.start();var t=angular.extend({},e.product,{categories:[e.selectedCateg._id]});r.save(t,function(t){e.productCreated=t,o.complete()})},e.onCategSelected=function(t){e.isCategSelected=!0,e.selectedCateg=t[t.length-1],e.error.category=!1},e.onCategUnselected=function(){e.isCategSelected=!1,e.selectedCateg=null}}]),angular.module("elementBoxApp.products.productList",["ui.tree"]).config(["$stateProvider",function(e){e.state("main.products.list",{url:"/list/{categ}/page-{page}",templateUrl:"products/products-list/products-list.html",controller:"ProductsListCtrl"})}]),angular.module("elementBoxApp.products.productList").controller("ProductsListCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$location","ProductsService","Categories",function(e,t,n,o,r,a,i,c){e.products=[],e.page=o.page?parseInt(o.page):1,e.pageSize=10,e.totalPages=0,e.totalProducts=0,e.currentCateg={},e.expandedNode={},e.isLoading=!1,e.categories=[],e.filter="";var l=!0;t.$emit("title","Products");var s=function(){var t=c.getCategoriesTree();t.query({flat:!1}).$promise.then(function(t){e.categories=t,u()})},u=function(){var t=m(e.categories[0]),n=r("filter")(t,{_id:o.categ},!0),a=n.length?t.indexOf(n[0]):0;e.currentCateg=t[a],l&&(e.page=o.page?parseInt(o.page):1),e.$watch("page",function(t,n){t===n||e.isLoading||e.fetchPage(e.currentCateg,e.page)}),e.fetchPage(e.currentCateg,e.page)};e.fetchPage=function(t,n){e.currentCateg=t?t:e.currentCateg,e.page=n?n:1,e.isLoading=!0,i.query({category:e.currentCateg._id,filter:e.filter||void 0,page:e.page,pageSize:e.pageSize}).$promise.then(function(t){l&&(l=!1),e.products=t.results,e.page=t.page,e.totalPages=t.totalPages,e.totalProducts=t.total,e.pageSize=t.pageSize,e.isLoading=!1,window.scrollY>150&&angular.element("body").animate({scrollTop:150},400)})};var m=function(e){var t=[];return t.push(e),e.children&&e.children.forEach(function(e){t.push.apply(t,m(e))}),t},p=function(){return angular.element(document.getElementById("tree-root")).scope().$$childHead};e.collapseEverything=function(){var e=p();e.collapseAll()},e.setExpandedNode=function(t){e.expandedNode=t},e.onSelectCateg=function(t){t===e.currentCateg||e.isLoading||(e.filter="",e.fetchPage(t,1))},e.onSearch=function(t){e.filter!==t&&(e.filter=t,e.fetchPage(e.currentCateg,e.page))},s()}]),angular.module("elementBoxApp.products.productInfo").directive("contact",function(){return{restrict:"E",templateUrl:"products/product-info/contact/contact-segment.html",transclude:!0,scope:{product:"="},controller:["$scope","ProductsService",function(e,t){e.checkinDate=null,e.checkoutDate=null,e.checkinOpened=!1,e.checkoutOpened=!1,e.contactSent=!1,e.checkinMinDate=new Date,e.checkoutMinDate=new Date,e.commentText="",e.doContact=function(){t.contact({_id:e.product._id,checkinDate:e.checkinDate,checkoutDate:e.checkoutDate,commentText:e.commentText}).$promise.then(function(){e.contactSent=!0})},e.openCheckin=function(t){t.preventDefault(),t.stopPropagation(),e.checkinOpened=!0,e.checkoutOpened=!1},e.openCheckout=function(t){t.preventDefault(),t.stopPropagation(),e.checkinOpened=!1,e.checkoutOpened=!0},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.dateOptions={formatYear:"yy",startingDay:1,closeText:"Close",showButtonBar:"false",showWeeks:"false"}}]}}),angular.module("elementBoxApp.products.productNew").directive("categSelector",function(){return{restrict:"E",scope:{categTree:"=",onDoneCbk:"=",onUndoneCbk:"=",api:"="},templateUrl:"products/product-new/categ-selector/categ-selector.html",controller:["$scope",function(e){e.currentOpts=e.categTree?e.categTree.children:[],e.selectedPath=[],e.selectedPath.push(e.categTree),e.done=!1,e.onDoneCbk=e.onDoneCbk&&angular.isFunction(e.onDoneCbk)?e.onDoneCbk:angular.noop,e.api=angular.isObject(e.api)?e.api:{},e.onSelectNode=function(t){e.done||(e.selectedPath.push(t),t.children&&t.children.length>0?e.currentOpts=t.children:(e.done=!0,e.onDoneCbk(e.selectedPath,e.selectedPath[e.selectedPath.length-1])))},e.onPathRestore=function(t,n){t.children&&t.children.length&&(e.currentOpts=t.children,e.selectedPath=e.selectedPath.slice(0,n+1),e.done&&(e.done=!1,e.onUndoneCbk(e.selectedPath,t)))},e.goBack=function(){if(1!==e.selectedPath.length){{e.selectedPath.pop()}e.currentOpts=e.selectedPath[e.selectedPath.length-1].children,e.done&&(e.done=!1,e.onUndoneCbk(e.selectedPath,e.selectedPath[e.selectedPath.length-1]))}};var t=function(e,n,o){if(n._id===e)return o.unshift(n),!0;var r;for(var a in n.children)if(r=t(e,n.children[a],o))return o.unshift(n),!0};e.api.setCategory=function(n){var o=[];t(n,e.categTree,o),e.selectedPath=o.slice(0,o.length-2),e.currentOpts=o[o.length-2].children,e.onSelectNode(o[o.length-1])},e.$watch("categTree",function(){e.currentOpts=e.categTree?e.categTree.children:[],e.selectedPath=[],e.selectedPath.push(e.categTree)})}]}}),angular.module("elementBoxApp.products.productList").directive("categTree",function(){return{restrict:"E",transclude:!0,replace:!1,scope:{onSelect:"="},template:'<div class="category-tree" ng-transclude></div>',controller:["$scope",function(e){this.groups=[],this.onSelect=e.onSelect?e.onSelect:this.onSelect,this.closeOthers=function(e){angular.forEach(this.groups,function(t){t!==e&&(t.isOpen=!1)})},this.addGroup=function(e){var t=this;this.groups.push(e),e.$on("$destroy",function(){t.removeGroup(e)})},this.removeGroup=function(e){var t=this.groups.indexOf(e);-1!==t&&this.groups.splice(t,1)},this.select=function(e){this.onSelect&&angular.isFunction(this.onSelect)&&this.onSelect(e)}}]}}).directive("categTreeNode",function(){return{require:"^categTree",restrict:"E",transclude:!0,templateUrl:"products/products-list/categ-tree/categ-tree-node.html",link:function(e,t,n,o){o.addGroup(e),e.isOpen=n.isOpen&&"true"===n.isOpen?!0:!1,e.toggleOpen=function(){e.isDisabled||(e.isOpen=!e.isOpen)},e.select=function(e){o.select(e)},e.isChildSelected=function(){var t=new RegExp("^"+e.node.path);return t.test(e.currentCateg.path)};var r=function(){e.isOpen=n.isOpen&&"true"===n.isOpen||e.isChildSelected()};r(),e.$watch("isOpen",function(t){t&&o.closeOthers(e)})}}});